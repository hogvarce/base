function addParamUrl(e,t){var a=window.location.href,o=new RegExp("[?|&]"+e+"=[0-9a-zA-Z_+-|.,;]*");if(o.test(a)){var o=new RegExp("[?&]"+e+"=([^&#]*)"),n=o.exec(a)[0].charAt(0);a=a.replace(o,n+e+"="+t)}else{var i=e+"="+t;if(a.indexOf("?")&&(a+="?"),a.indexOf("#")>-1){var s=a.split("#");a=s[0]+"&"+i+(s[1]?"#"+s[1]:"")}else a+="&"+i}window.history.pushState(null,document.title,a),location.href=a}function declOfNum(e,t){return cases=[2,0,1,1,1,2],t[e%100>4&&20>e%100?2:cases[5>e%10?e%10:5]]}var app=app||{};app.Basket=Backbone.Model.extend({defaults:{goodsCount:JSON.parse(localStorage.getItem("basket")||"[]").length}});var app=app||{};app.singleGood=Backbone.Model.extend({defaults:{pagetitle:"undefined",price:0,image:"/img/no_photo.png",count:1}});var app=app||{};app.allGoodsViews=Backbone.View.extend({tagName:"ul",className:"row list-inline",render:function(){return this.collection.each(this.addGood,this),setTimeout(function(){$(".goods .row").masonry({itemSelector:".good",columnWidth:230,gutterWidth:25,isAnimated:!0,isResizable:!0})},500),this},addGood:function(e){var t=new app.singleGoodView({model:e}),a=.5*Math.random()+.5;t.$el.attr("data-wow-delay",a+"s"),this.$el.append(t.render().el)}});var app=app||{};app.basketCounter=Backbone.View.extend({render:function(){$(".cart_num a").text(this.model.get("goodsCount")+" "+declOfNum(this.model.get("goodsCount"),["позиция","позиции","позиций"])),this.listenTo(this.model,"change",this.addBasket)},addBasket:function(){$(".cart_num a").text(this.model.get("goodsCount")+" "+declOfNum(this.model.get("goodsCount"),["позиция","позиции","позиций"]))},clearBasket:function(){localStorage.setItem("basket",""),app.BasketModel.set("goodsCount",0)}});var app=app||{};app.singleGoodView=Backbone.View.extend({tagName:"li",className:"good wow animate zoomIn",template:_.template($("#Good").html()||""),render:function(){var e=this.template(this.model.toJSON());return this.$el.html(e),this},events:{"change .buy + input":function(e){this.model.set("count",$(e.target).val())},"click img.good-preview":"openFrame","click .buy":"Buy"},openFrame:function(){var e=this.$(".description").html();$.fancybox({content:e})},Buy:function(){var e={goodID:this.model.get("id"),goodTitle:this.model.get("pagetitle"),goodArticle:this.model.get("articale"),goodColor:this.model.get("color"),goodCount:this.model.get("count"),goodCountInPack:this.model.get("count_in_pack")},t=JSON.parse(localStorage.getItem("basket")||"[]");t.push(e),app.BasketModel.set("goodsCount",t.length),localStorage.setItem("basket",JSON.stringify(t))}});var app=app||{};app.GoodsCollections=Backbone.Collection.extend({model:app.singleGood});var app=app||{};if(app.Router=Backbone.Router.extend({routes:{},initialize:function(){var e=parseInt($.url().param("pagin"),10)||1,t=parseInt($.url().param("category"),10)||0,a=new app.GoodsCollections;if(0!=t){var o="parent IN (SELECT id FROM goods_category WHERE id='"+t+"')";a.url='/api/goods?filter="'+o+'"&page='+e}else a.url="/api/goods?page="+e;a.fetch({success:function(e,a,o){for(var n=new app.allGoodsViews({collection:e}),i=o.xhr.getResponseHeader("X-Pagination-Page-Count"),s=o.xhr.getResponseHeader("X-Pagination-Current-Page"),p='<div class="pagination">',l="",d=1;i>=d;d++)l=s==d?'class="pagin active"':'class="pagin"',p+="<a "+l+'href="?pagin='+d+"&category="+t+'"><span>'+d+"</span></a>";p+="</div>",$(".goods").append(n.render().el).before(p).after(p)}})}}),$(".goods").length){var goodsRoute=new app.Router;Backbone.history.start({pushState:!0})}app.BasketModel=new app.Basket;var BasketCountView=new app.basketCounter({model:app.BasketModel});BasketCountView.render(),$(function(){(new WOW).init(),$(".navigation .nav a").each(function(e){var t=$(this).attr("href");location.pathname==t&&$(this).parent().addClass("active")}),$(".navigation").tmStickUp()}());